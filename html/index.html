<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Pi-Zero Wi-Fi</title>
<style>
  table { border-collapse: collapse; font-family: sans-serif }
  td,th { padding: .4em .7em; border: 1px solid #ccc; }
  button { padding: .2em .8em; }
</style>
</head>
<body>
<h1>Available networks</h1>
<table id="aps"><thead>
  <tr><th>SSID</th><th>Signal</th><th>Security</th><th>Action</th></tr>
</thead><tbody></tbody></table>

<script>
async function loadAPs() {
  const aps = await (await fetch('api/scan.php')).json();
  const body = document.querySelector('#aps tbody');
  body.innerHTML = '';
  aps.sort((a,b)=>b.sig-a.sig).forEach(ap=>{
    const tr = body.insertRow();
    tr.insertCell().textContent = ap.ssid;
    tr.insertCell().textContent = ap.sig + '%';
    tr.insertCell().textContent = ap.sec;
    const btn = document.createElement('button');
    btn.textContent = 'Connect';
    btn.onclick = ()=>connect(ap);
    tr.insertCell().appendChild(btn);
  });
}

async function connect(ap){
  let pw = '';
  if (ap.sec !== 'OPEN'){
    pw = prompt('Password for '+ap.ssid+':','');
    if (pw===null) return;
  }
  const fd = new FormData();
  fd.append('ssid', ap.ssid);
  fd.append('password', pw);
  const res = await fetch('api/connect.php',{method:'POST',body:fd});
  const j   = await res.json();
  alert(j.output || 'Done (exit '+j.status+')');
  loadAPs();
}

loadAPs();
</script>
</body>
</html>

